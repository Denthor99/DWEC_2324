<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BBDD MongoDB</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>
    $(function(){
    $('form').submit(function(e) {
        // Previene el comportamiento predeterminado del formulario (enviar la solicitud)
        e.preventDefault();

        // Obtiene los valores del formulario
        let nombre = $("#nombre").val();  
        let apellidos = $("#apellidos").val();

        // Crea un objeto con los datos del formulario
        let objeto = {
            nombre: nombre,
            apellidos: apellidos
        };

        // Realiza una solicitud POST al servidor
        fetch("/datos", {
            method: "POST",
            body: JSON.stringify(objeto),
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(res => res.json())
        .then(obj => {
            // Muestra la tabla y actualiza los datos
            $("#datosMongoDB").show();
            $("#datosMongoDB").empty(); // Limpia la tabla antes de agregar nuevas filas
            obj.forEach(usuario => {
                // Agrega los datos de cada usuario a la tabla
                $("#datosMongoDB").append(`<tr><td>${usuario.nombre}</td><td>${usuario.apellidos}</td></tr>`);
            });
        })
        .catch(error => {
            // Maneja cualquier error que ocurra durante la solicitud
            console.error('Error:', error);
        });
    });
});

    </script>
</head>
<body>
    <h1>Formulario de nuevos usuarios</h1>
    <form action="" method="POST">
        <label for="nombre">Nombre</label><br>
        <input type="text" name="nombre" id="nombre" required><br>
        <label for="apellidos">Apellidos</label><br>
        <input type="text" name="apellidos" id="apellidos" required><br>
        <button type="submit" id="botInsertar">Enviar datos</button>
    </form>
    <br>
    <table id="datosMongoDB" border="1" hidden></table>
</body>
</html>